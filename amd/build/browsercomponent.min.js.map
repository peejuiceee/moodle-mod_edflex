{"version":3,"file":"browsercomponent.min.js","sources":["../src/browsercomponent.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Browser component.\n *\n * @module    mod_edflex/browsercomponent\n * @copyright 2025 Edflex <support@edflex.com>\n * @license   https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport {exception} from 'core/notification';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Autocomplete from \"core/form-autocomplete\";\n\nexport default class BrowserComponent extends BaseComponent {\n    showselectedcontents = false;\n    coursedata = {};\n    contentscache = {};\n    selectedcontents = [];\n    searchresult = [];\n\n    constructor(data) {\n        super(data);\n        this.coursedata = data.coursedata || {};\n    }\n\n    create() {\n        const self = this;\n\n        self.selectors = {\n            PAGE: '[data-page]',\n            RESULTS: '.edflex-results',\n            RESULTS_LOADING: '.edflex-loading-results',\n            RESULTS_EMPTY: '.edflex-no-results',\n            RESULTS_ERROR: '.edflex-errors',\n            RESULTS_LIST: '.edflex-results-list',\n            RESULTS_ACTIONS: '.edflex-results-actions',\n            RESULT_CHECKBOX: '.edflex-id',\n            IMPORT_BUTTON: '.edflex-import-activities',\n            SEARCH_BUTTON: '#edflexsearchactivities',\n            SHOW_SEARCH_RESULT_BUTTON: '.show-search-result',\n            SHOW_SELECTED_CONTENTS_BUTTON: '.show-selected-contents',\n            SELECTED_CONTENTS_LIST: '.selected-contents',\n\n            // Filters\n            QUERY: '#edflex_query',\n            TYPE: '#edflex_content_type',\n            LANGUAGE: '#edflex_content_language',\n            CATEGORY: '#edflex_content_category',\n        };\n\n\n        self.loadBrowserContent()\n            .then(() => {\n                self.initElements();\n                self.initEventListeners();\n\n                self.elements.searchButton.disabled = true; // Disable search button by default\n                self.elements.importButton.classList.add('d-none'); // Hide import button by default\n\n                const modalElement = self.element.closest(\".modal-dialog\");\n\n                if (modalElement) {\n                    const modalFooter = modalElement.querySelector('.modal-footer');\n                    modalFooter.appendChild(self.elements.actions);\n                }\n\n                self.element\n                    .querySelectorAll('.select-multiple')\n                    .forEach((sel) => {\n                        Autocomplete.enhance(sel, false, false, '', false, true, undefined, true);\n\n                        sel.addEventListener('change', () => {\n                            const wrapper = sel.closest('.form-autocomplete, div.position-relative, div[id^=\"yui_\"]');\n                            const input = wrapper?.querySelector('input.form-control[data-fieldtype=\"autocomplete\"]');\n                            if (input) {\n                                input.value = '';\n                                input.dispatchEvent(new Event('input', {bubbles: true}));\n                            }\n                        });\n                    })\n                ;\n\n                return true;\n            })\n            .catch(exception)\n        ;\n    }\n\n    initElements() {\n        const self = this;\n\n        self.elements = {\n            loading: self.element.querySelector(self.selectors.RESULTS_LOADING),\n            empty: self.element.querySelector(self.selectors.RESULTS_EMPTY),\n            errors: self.element.querySelector(self.selectors.RESULTS_ERROR),\n            list: self.element.querySelector(self.selectors.RESULTS_LIST),\n            selectedList: self.element.querySelector(self.selectors.SELECTED_CONTENTS_LIST),\n            actions: self.element.querySelector(self.selectors.RESULTS_ACTIONS),\n            query: self.element.querySelector(self.selectors.QUERY),\n            type: self.element.querySelector(self.selectors.TYPE),\n            language: self.element.querySelector(self.selectors.LANGUAGE),\n            category: self.element.querySelector(self.selectors.CATEGORY),\n            searchButton: self.element.querySelector(self.selectors.SEARCH_BUTTON),\n            importButton: self.element.querySelector(self.selectors.IMPORT_BUTTON),\n            showSearchResultButton: self.element.querySelector(self.selectors.SHOW_SEARCH_RESULT_BUTTON),\n            showSelectedContentsButton: self.element.querySelector(self.selectors.SHOW_SELECTED_CONTENTS_BUTTON),\n        };\n    }\n\n    initEventListeners() {\n        const self = this;\n\n        // Listen for changes in filter inputs\n        const filterElements = [\n            self.elements.query,\n            self.elements.type,\n            self.elements.language,\n            self.elements.category,\n        ];\n\n        filterElements.forEach(element => {\n            let events = ['change'];\n\n            if (element.type === 'text') {\n                events.push('input');\n            }\n\n            events.forEach((eventname) => {\n                element.addEventListener(eventname, () => {\n                    self.elements.searchButton.disabled = self.filtersAreEmpty();\n                });\n            });\n        });\n\n        self.elements.query.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                self.search();\n            }\n        });\n\n        self.element.addEventListener('change', (e) => {\n            if (e.target.matches(self.selectors.RESULT_CHECKBOX)) {\n                const checkbox = e.target;\n                if (checkbox.checked && checkbox.classList.contains('confirm')) {\n                    const ok = confirm(M.util.get_string('confirmsameactivitymultipletimesinthecourse', 'mod_edflex'));\n\n                    if (!ok) {\n                        checkbox.checked = false;\n                    }\n                }\n\n                const contentid = checkbox.value;\n\n                if (checkbox.checked) {\n                    self.selectContent(contentid);\n                } else {\n                    self.unselectContent(contentid);\n                }\n            }\n        });\n\n        self.element.addEventListener('click', (e) => {\n            if (e.target.matches(self.selectors.PAGE)) {\n                const page = e.target.getAttribute('data-page');\n                self.search(page);\n            }\n        });\n\n        self.elements.searchButton.addEventListener('click', e => {\n            e.preventDefault();\n            self.search();\n        });\n\n        self.elements.showSelectedContentsButton.addEventListener('click', e => {\n            e.preventDefault();\n            self.showselectedcontents = true;\n\n            self.resetDisplay();\n            self.showSelectedContents();\n            self.refreshActionButtons();\n        });\n\n        self.elements.showSearchResultButton.addEventListener('click', e => {\n            e.preventDefault();\n            self.showselectedcontents = false;\n\n            self.resetDisplay();\n            self.showSearchResult();\n            self.refreshActionButtons();\n        });\n\n        self.elements.importButton.addEventListener('click', (e) => {\n            e.preventDefault();\n            const ids = self.selectedcontents.map(item => item.edflexid);\n\n            if (!ids.length) {\n                return true;\n            }\n\n            const args = {\n                edflexid: ids,\n                course: self.coursedata.course,\n                section: self.coursedata.section\n            };\n\n            const xhr = Ajax.call([{\n                methodname: 'mod_edflex_import_activity',\n                args: args\n            }])[0];\n\n            return xhr.then(({activities, course}) => {\n                let redirecturl;\n\n                if (activities && activities.length === 1) {\n                    redirecturl = activities[0].url;\n                }\n\n                if (!redirecturl) {\n                    redirecturl = course.url;\n                }\n\n                window.location.assign(redirecturl);\n\n                return true;\n            }).catch((error) => {\n                self.showError(error.message || error);\n            });\n        });\n    }\n\n    refreshActionButtons() {\n        const self = this;\n        const {importButton, showSearchResultButton, showSelectedContentsButton} = self.elements;\n\n        if (self.selectedcontents.length) {\n            importButton.classList.remove('d-none');\n        } else {\n            importButton.classList.add('d-none');\n        }\n\n        showSelectedContentsButton.classList.add('d-none');\n        showSearchResultButton.classList.add('d-none');\n\n        if (self.showselectedcontents) {\n            showSearchResultButton.classList.remove('d-none');\n        } else if (self.selectedcontents.length) {\n            showSelectedContentsButton.classList.remove('d-none');\n        }\n    }\n\n    getFilters() {\n        const self = this;\n\n        return {\n            query: (self.elements.query?.value || '').trim(),\n            type: Array.from(self.elements.type.selectedOptions).map(opt => opt.value).join(','),\n            language: Array.from(self.elements.language.selectedOptions).map(opt => opt.value).join(','),\n            category: Array.from(self.elements.category.selectedOptions).map(opt => opt.value).join(','),\n        };\n    }\n\n    filtersAreEmpty() {\n        const self = this;\n        const filters = self.getFilters();\n\n        for (const filter in filters) {\n            if (filters[filter]) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    search(page = 1) {\n        const self = this;\n        const filters = self.getFilters();\n        const course = self.coursedata.course;\n        const {empty} = self.elements;\n\n        self.resetDisplay();\n\n        const promise = Ajax.call([{\n            methodname: 'mod_edflex_browser_search',\n            args: {filters, course, page},\n        }])[0].then((result) => {\n            self.searchresult = result;\n            self.showSearchResult();\n            self.elements.searchButton.disabled = true;\n\n            return result;\n        }).catch((error) => {\n            empty.classList.remove('d-none');\n            self.showError(error.message || error);\n        });\n\n        self.showLoader(promise);\n\n        return promise;\n    }\n\n    showLoader(promise) {\n        const self = this;\n        const {loading} = self.elements;\n\n        loading.classList.remove('d-none');\n\n        promise\n            .then((data) => {\n                loading.classList.add('d-none');\n\n                return data;\n            })\n            .catch((err) => {\n                loading.classList.add('d-none');\n\n                return err;\n            });\n    }\n\n    showSearchResult() {\n        const self = this;\n        let {contents, pages} = self.searchresult;\n        const selectedcontents = Object.fromEntries(self.selectedcontents.map((item) => [item.edflexid, true]));\n        const {empty, list} = self.elements;\n\n        if (!contents || contents.length === 0) {\n            empty.classList.remove('d-none');\n        } else {\n            contents = contents.map((item) => {\n                item.is_selected = selectedcontents[item.edflexid] || false;\n\n                return item;\n            });\n\n            Templates\n                .render('mod_edflex/content_search_result', {contents, pages})\n                .then((html) => {\n                    list.innerHTML = html;\n                    return html;\n                })\n                .catch((error) => {\n                    self.showError(error.message || error);\n                });\n\n            list.classList.remove('d-none');\n        }\n    }\n\n    showSelectedContents() {\n        const self = this;\n\n        self.showselectedcontents = true;\n\n        const {empty, selectedList} = self.elements;\n\n        if (!self.selectedcontents.length) {\n            empty.classList.remove('d-none');\n        } else {\n            self.selectedcontents.map((item) => {\n                item.is_selected = true;\n                return item;\n            });\n\n            Templates\n                .render('mod_edflex/content_search_result', {contents: self.selectedcontents})\n                .then((html) => {\n                    selectedList.innerHTML = html;\n\n                    return html;\n                })\n                .catch((error) => {\n                    self.showError(error.message || error);\n                });\n\n            selectedList.classList.remove('d-none');\n        }\n    }\n\n    loadBrowserContent() {\n        const self = this;\n\n        return Ajax.call([{\n            methodname: 'mod_edflex_browser_html',\n            args: {}\n        }])[0].then((response) => {\n            // Parse the HTML string into a DOM element.\n            self.element.innerHTML = response.html;\n\n            return response;\n        });\n    }\n\n    resetDisplay() {\n        const self = this;\n        const {empty, list, selectedList, errors} = self.elements;\n\n        self.showselectedcontents = false;\n\n        // Reset display\n        empty.classList.add('d-none');\n\n        list.classList.add('d-none');\n\n        selectedList.classList.add('d-none');\n\n        errors.classList.add('d-none');\n\n        self.refreshActionButtons();\n    }\n\n    showError(error) {\n        const self = this;\n        if (self.elements.errors) {\n            self.elements.errors.classList.remove('d-none');\n            self.elements.errors.innerHTML = error;\n        }\n    }\n\n    selectContent(contentid) {\n        const self = this;\n        const contents = self.searchresult?.contents || [];\n        const isselected = self.selectedcontents.find((item) => item.edflexid === contentid);\n\n        if (isselected) {\n            return;\n        }\n\n        const content = self.contentscache[contentid]\n            || contents.find((item) => item.edflexid === contentid);\n\n        if (content) {\n            self.contentscache[content.edflexid] = content;\n            self.selectedcontents.push(content);\n        }\n\n        self.refreshActionButtons();\n    }\n\n    unselectContent(contentid) {\n        const self = this;\n        self.selectedcontents = self.selectedcontents.filter((item) => item.edflexid !== contentid);\n\n        self.refreshActionButtons();\n    }\n}\n"],"names":["BrowserComponent","BaseComponent","constructor","data","coursedata","create","self","this","selectors","PAGE","RESULTS","RESULTS_LOADING","RESULTS_EMPTY","RESULTS_ERROR","RESULTS_LIST","RESULTS_ACTIONS","RESULT_CHECKBOX","IMPORT_BUTTON","SEARCH_BUTTON","SHOW_SEARCH_RESULT_BUTTON","SHOW_SELECTED_CONTENTS_BUTTON","SELECTED_CONTENTS_LIST","QUERY","TYPE","LANGUAGE","CATEGORY","loadBrowserContent","then","initElements","initEventListeners","elements","searchButton","disabled","importButton","classList","add","modalElement","element","closest","querySelector","appendChild","actions","querySelectorAll","forEach","sel","enhance","undefined","addEventListener","wrapper","input","value","dispatchEvent","Event","bubbles","catch","exception","loading","empty","errors","list","selectedList","query","type","language","category","showSearchResultButton","showSelectedContentsButton","events","push","eventname","filtersAreEmpty","e","key","search","target","matches","checkbox","checked","contains","confirm","M","util","get_string","contentid","selectContent","unselectContent","page","getAttribute","preventDefault","showselectedcontents","resetDisplay","showSelectedContents","refreshActionButtons","showSearchResult","ids","selectedcontents","map","item","edflexid","length","args","course","section","Ajax","call","methodname","_ref","redirecturl","activities","url","window","location","assign","error","showError","message","remove","getFilters","trim","Array","from","selectedOptions","opt","join","filters","filter","promise","result","searchresult","showLoader","err","contents","pages","Object","fromEntries","is_selected","render","html","innerHTML","response","find","content","contentscache"],"mappings":"orBA6BqBA,yBAAyBC,wBAO1CC,YAAYC,YACFA,mDAPa,qCACV,yCACG,4CACG,wCACJ,SAINC,WAAaD,KAAKC,YAAc,GAGzCC,eACUC,KAAOC,KAEbD,KAAKE,UAAY,CACbC,KAAM,cACNC,QAAS,kBACTC,gBAAiB,0BACjBC,cAAe,qBACfC,cAAe,iBACfC,aAAc,uBACdC,gBAAiB,0BACjBC,gBAAiB,aACjBC,cAAe,4BACfC,cAAe,0BACfC,0BAA2B,sBAC3BC,8BAA+B,0BAC/BC,uBAAwB,qBAGxBC,MAAO,gBACPC,KAAM,uBACNC,SAAU,2BACVC,SAAU,4BAIdnB,KAAKoB,qBACAC,MAAK,KACFrB,KAAKsB,eACLtB,KAAKuB,qBAELvB,KAAKwB,SAASC,aAAaC,UAAW,EACtC1B,KAAKwB,SAASG,aAAaC,UAAUC,IAAI,gBAEnCC,aAAe9B,KAAK+B,QAAQC,QAAQ,oBAEtCF,aAAc,CACMA,aAAaG,cAAc,iBACnCC,YAAYlC,KAAKwB,SAASW,gBAG1CnC,KAAK+B,QACAK,iBAAiB,oBACjBC,SAASC,gCACOC,QAAQD,KAAK,GAAO,EAAO,IAAI,GAAO,OAAME,GAAW,GAEpEF,IAAIG,iBAAiB,UAAU,WACrBC,QAAUJ,IAAIN,QAAQ,8DACtBW,MAAQD,MAAAA,eAAAA,QAAST,cAAc,qDACjCU,QACAA,MAAMC,MAAQ,GACdD,MAAME,cAAc,IAAIC,MAAM,QAAS,CAACC,SAAS,aAM1D,KAEVC,MAAMC,yBAIf3B,eACiBrB,KAERuB,SAAW,CACZ0B,QAHSjD,KAGK8B,QAAQE,cAHbhC,KAGgCC,UAAUG,iBACnD8C,MAJSlD,KAIG8B,QAAQE,cAJXhC,KAI8BC,UAAUI,eACjD8C,OALSnD,KAKI8B,QAAQE,cALZhC,KAK+BC,UAAUK,eAClD8C,KANSpD,KAME8B,QAAQE,cANVhC,KAM6BC,UAAUM,cAChD8C,aAPSrD,KAOU8B,QAAQE,cAPlBhC,KAOqCC,UAAUa,wBACxDoB,QARSlC,KAQK8B,QAAQE,cARbhC,KAQgCC,UAAUO,iBACnD8C,MATStD,KASG8B,QAAQE,cATXhC,KAS8BC,UAAUc,OACjDwC,KAVSvD,KAUE8B,QAAQE,cAVVhC,KAU6BC,UAAUe,MAChDwC,SAXSxD,KAWM8B,QAAQE,cAXdhC,KAWiCC,UAAUgB,UACpDwC,SAZSzD,KAYM8B,QAAQE,cAZdhC,KAYiCC,UAAUiB,UACpDM,aAbSxB,KAaU8B,QAAQE,cAblBhC,KAaqCC,UAAUU,eACxDe,aAdS1B,KAcU8B,QAAQE,cAdlBhC,KAcqCC,UAAUS,eACxDgD,uBAfS1D,KAeoB8B,QAAQE,cAf5BhC,KAe+CC,UAAUW,2BAClE+C,2BAhBS3D,KAgBwB8B,QAAQE,cAhBhChC,KAgBmDC,UAAUY,gCAI9ES,2BACUvB,KAAOC,KAGU,CACnBD,KAAKwB,SAAS+B,MACdvD,KAAKwB,SAASgC,KACdxD,KAAKwB,SAASiC,SACdzD,KAAKwB,SAASkC,UAGHrB,SAAQN,cACf8B,OAAS,CAAC,UAEO,SAAjB9B,QAAQyB,MACRK,OAAOC,KAAK,SAGhBD,OAAOxB,SAAS0B,YACZhC,QAAQU,iBAAiBsB,WAAW,KAChC/D,KAAKwB,SAASC,aAAaC,SAAW1B,KAAKgE,2BAKvDhE,KAAKwB,SAAS+B,MAAMd,iBAAiB,WAAYwB,IAC/B,UAAVA,EAAEC,KACFlE,KAAKmE,YAIbnE,KAAK+B,QAAQU,iBAAiB,UAAWwB,OACjCA,EAAEG,OAAOC,QAAQrE,KAAKE,UAAUQ,iBAAkB,OAC5C4D,SAAWL,EAAEG,UACfE,SAASC,SAAWD,SAAS1C,UAAU4C,SAAS,WAAY,CACjDC,QAAQC,EAAEC,KAAKC,WAAW,8CAA+C,iBAGhFN,SAASC,SAAU,SAIrBM,UAAYP,SAAS1B,MAEvB0B,SAASC,QACTvE,KAAK8E,cAAcD,WAEnB7E,KAAK+E,gBAAgBF,eAKjC7E,KAAK+B,QAAQU,iBAAiB,SAAUwB,OAChCA,EAAEG,OAAOC,QAAQrE,KAAKE,UAAUC,MAAO,OACjC6E,KAAOf,EAAEG,OAAOa,aAAa,aACnCjF,KAAKmE,OAAOa,UAIpBhF,KAAKwB,SAASC,aAAagB,iBAAiB,SAASwB,IACjDA,EAAEiB,iBACFlF,KAAKmE,YAGTnE,KAAKwB,SAASoC,2BAA2BnB,iBAAiB,SAASwB,IAC/DA,EAAEiB,iBACFlF,KAAKmF,sBAAuB,EAE5BnF,KAAKoF,eACLpF,KAAKqF,uBACLrF,KAAKsF,0BAGTtF,KAAKwB,SAASmC,uBAAuBlB,iBAAiB,SAASwB,IAC3DA,EAAEiB,iBACFlF,KAAKmF,sBAAuB,EAE5BnF,KAAKoF,eACLpF,KAAKuF,mBACLvF,KAAKsF,0BAGTtF,KAAKwB,SAASG,aAAac,iBAAiB,SAAUwB,IAClDA,EAAEiB,uBACIM,IAAMxF,KAAKyF,iBAAiBC,KAAIC,MAAQA,KAAKC,eAE9CJ,IAAIK,cACE,QAGLC,KAAO,CACTF,SAAUJ,IACVO,OAAQ/F,KAAKF,WAAWiG,OACxBC,QAAShG,KAAKF,WAAWkG,gBAGjBC,cAAKC,KAAK,CAAC,CACnBC,WAAY,6BACZL,KAAMA,QACN,GAEOzE,MAAK+E,WACRC,aADSC,WAACA,WAADP,OAAaA,oBAGtBO,YAAoC,IAAtBA,WAAWT,SACzBQ,YAAcC,WAAW,GAAGC,KAG3BF,cACDA,YAAcN,OAAOQ,KAGzBC,OAAOC,SAASC,OAAOL,cAEhB,KACRrD,OAAO2D,QACN3G,KAAK4G,UAAUD,MAAME,SAAWF,aAK5CrB,6BAEU3D,aAACA,aAADgC,uBAAeA,uBAAfC,2BAAuCA,4BADhC3D,KACmEuB,SADnEvB,KAGJwF,iBAAiBI,OACtBlE,aAAaC,UAAUkF,OAAO,UAE9BnF,aAAaC,UAAUC,IAAI,UAG/B+B,2BAA2BhC,UAAUC,IAAI,UACzC8B,uBAAuB/B,UAAUC,IAAI,UAVxB5B,KAYJkF,qBACLxB,uBAAuB/B,UAAUkF,OAAO,UAb/B7G,KAcGwF,iBAAiBI,QAC7BjC,2BAA2BhC,UAAUkF,OAAO,UAIpDC,4CAGW,CACHxD,qCAHStD,KAGIuB,SAAS+B,kEAAOX,QAAS,IAAIoE,OAC1CxD,KAAMyD,MAAMC,KAJHjH,KAIauB,SAASgC,KAAK2D,iBAAiBzB,KAAI0B,KAAOA,IAAIxE,QAAOyE,KAAK,KAChF5D,SAAUwD,MAAMC,KALPjH,KAKiBuB,SAASiC,SAAS0D,iBAAiBzB,KAAI0B,KAAOA,IAAIxE,QAAOyE,KAAK,KACxF3D,SAAUuD,MAAMC,KANPjH,KAMiBuB,SAASkC,SAASyD,iBAAiBzB,KAAI0B,KAAOA,IAAIxE,QAAOyE,KAAK,MAIhGrD,wBAEUsD,QADOrH,KACQ8G,iBAEhB,MAAMQ,UAAUD,WACbA,QAAQC,eACD,SAIR,EAGXpD,aAAOa,4DAAO,QACJhF,KAAOC,KACPqH,QAAUtH,KAAK+G,aACfhB,OAAS/F,KAAKF,WAAWiG,QACzB5C,MAACA,OAASnD,KAAKwB,SAErBxB,KAAKoF,qBAECoC,QAAUvB,cAAKC,KAAK,CAAC,CACvBC,WAAY,4BACZL,KAAM,CAACwB,QAAAA,QAASvB,OAAAA,OAAQf,KAAAA,SACxB,GAAG3D,MAAMoG,SACTzH,KAAK0H,aAAeD,OACpBzH,KAAKuF,mBACLvF,KAAKwB,SAASC,aAAaC,UAAW,EAE/B+F,UACRzE,OAAO2D,QACNxD,MAAMvB,UAAUkF,OAAO,UACvB9G,KAAK4G,UAAUD,MAAME,SAAWF,iBAGpC3G,KAAK2H,WAAWH,SAETA,QAGXG,WAAWH,eAEDtE,QAACA,SADMjD,KACUuB,SAEvB0B,QAAQtB,UAAUkF,OAAO,UAEzBU,QACKnG,MAAMxB,OACHqD,QAAQtB,UAAUC,IAAI,UAEfhC,QAEVmD,OAAO4E,MACJ1E,QAAQtB,UAAUC,IAAI,UAEf+F,OAInBrC,yBACUvF,KAAOC,SACT4H,SAACA,SAADC,MAAWA,OAAS9H,KAAK0H,mBACvBjC,iBAAmBsC,OAAOC,YAAYhI,KAAKyF,iBAAiBC,KAAKC,MAAS,CAACA,KAAKC,UAAU,OAC1FzC,MAACA,MAADE,KAAQA,MAAQrD,KAAKwB,SAEtBqG,UAAgC,IAApBA,SAAShC,QAGtBgC,SAAWA,SAASnC,KAAKC,OACrBA,KAAKsC,YAAcxC,iBAAiBE,KAAKC,YAAa,EAE/CD,2BAINuC,OAAO,mCAAoC,CAACL,SAAAA,SAAUC,MAAAA,QACtDzG,MAAM8G,OACH9E,KAAK+E,UAAYD,KACVA,QAEVnF,OAAO2D,QACJ3G,KAAK4G,UAAUD,MAAME,SAAWF,UAGxCtD,KAAKzB,UAAUkF,OAAO,WAlBtB3D,MAAMvB,UAAUkF,OAAO,UAsB/BzB,6BACUrF,KAAOC,KAEbD,KAAKmF,sBAAuB,QAEtBhC,MAACA,MAADG,aAAQA,cAAgBtD,KAAKwB,SAE9BxB,KAAKyF,iBAAiBI,QAGvB7F,KAAKyF,iBAAiBC,KAAKC,OACvBA,KAAKsC,aAAc,EACZtC,2BAINuC,OAAO,mCAAoC,CAACL,SAAU7H,KAAKyF,mBAC3DpE,MAAM8G,OACH7E,aAAa8E,UAAYD,KAElBA,QAEVnF,OAAO2D,QACJ3G,KAAK4G,UAAUD,MAAME,SAAWF,UAGxCrD,aAAa1B,UAAUkF,OAAO,WAlB9B3D,MAAMvB,UAAUkF,OAAO,UAsB/B1F,2BACUpB,KAAOC,YAENgG,cAAKC,KAAK,CAAC,CACdC,WAAY,0BACZL,KAAM,MACN,GAAGzE,MAAMgH,WAETrI,KAAK+B,QAAQqG,UAAYC,SAASF,KAE3BE,YAIfjD,qBAEUjC,MAACA,MAADE,KAAQA,KAARC,aAAcA,aAAdF,OAA4BA,QADrBnD,KACoCuB,SADpCvB,KAGRkF,sBAAuB,EAG5BhC,MAAMvB,UAAUC,IAAI,UAEpBwB,KAAKzB,UAAUC,IAAI,UAEnByB,aAAa1B,UAAUC,IAAI,UAE3BuB,OAAOxB,UAAUC,IAAI,UAZR5B,KAcRqF,uBAGTsB,UAAUD,aACA3G,KAAOC,KACTD,KAAKwB,SAAS4B,SACdpD,KAAKwB,SAAS4B,OAAOxB,UAAUkF,OAAO,UACtC9G,KAAKwB,SAAS4B,OAAOgF,UAAYzB,OAIzC7B,cAAcD,wCACJ7E,KAAOC,KACP4H,qCAAW7H,KAAK0H,qEAAcG,WAAY,MAC7B7H,KAAKyF,iBAAiB6C,MAAM3C,MAASA,KAAKC,WAAaf,yBAMpE0D,QAAUvI,KAAKwI,cAAc3D,YAC5BgD,SAASS,MAAM3C,MAASA,KAAKC,WAAaf,YAE7C0D,UACAvI,KAAKwI,cAAcD,QAAQ3C,UAAY2C,QACvCvI,KAAKyF,iBAAiB3B,KAAKyE,UAG/BvI,KAAKsF,uBAGTP,gBAAgBF,WACC5E,KACRwF,iBADQxF,KACgBwF,iBAAiB8B,QAAQ5B,MAASA,KAAKC,WAAaf,YADpE5E,KAGRqF"}