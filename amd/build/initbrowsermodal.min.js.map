{"version":3,"file":"initbrowsermodal.min.js","sources":["../src/initbrowsermodal.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Initializes and displays the activity modal with the provided course data.\n *\n * @module    mod_edflex/initbrowsermodal\n * @copyright 2025 Edflex <support@edflex.com>\n * @license   https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from \"core/modal_events\";\nimport {exception} from 'core/notification';\nimport BrowserComponent from './browsercomponent';\n\nexport const init = () => {\n    document.body.addEventListener('click', (e) => {\n        if (e.target.closest('[name=\"openedflexbrowser\"]')) {\n            e.preventDefault();\n            const url = new URL(window.location);\n\n            const coursedata = {\n                course: url.searchParams.get('course'),\n                section: url.searchParams.get('section')\n            };\n\n            return initActivityModal(coursedata);\n        }\n\n        if (e.target.closest('[data-modname^=\"mod_edflex\"]')) {\n            const el = e.target.closest('[data-modname^=\"mod_edflex\"]');\n            const href = el && el.querySelector('[data-action=\"add-chooser-option\"]').getAttribute('href');\n\n            if (!href) {\n                return false;\n            }\n\n            e.preventDefault();\n\n            const url = new URL(href);\n            const coursedata = {\n                course: url.searchParams.get('id'),\n                section: url.searchParams.get('section')\n            };\n\n            return initActivityModal(coursedata);\n        }\n    });\n\n    /**\n     * Initializes and displays the activity modal with the provided course data.\n     *\n     * @param {Object} coursedata - Data related to the course to be loaded into the modal.\n     * @return {Promise} A promise that resolves when the modal is successfully shown or rejects on error.\n     */\n    function initActivityModal(coursedata) {\n        ModalFactory.create({\n            type: ModalFactory.types.DEFAULT,\n            title: M.util.get_string('edflexbrowsertitle', 'mod_edflex'),\n            body: `<div class=\"edflex-browser-wrapper\">\n                        <div class=\"my-3 py-5 text-center\"><div class=\"spinner-border\" role=\"status\"></div></div>\n                   </div>`,\n            footer: '<div></div>',\n            large: true\n        }).then((modal) => {\n            modal.show();\n            modal.getRoot()\n                .on(ModalEvents.hidden, () => {\n                    modal.destroy();\n                })\n            ;\n\n            new BrowserComponent({\n                element: modal.getRoot()[0].querySelector('.edflex-browser-wrapper'),\n                coursedata\n            });\n\n            return true;\n        }).catch(exception);\n    }\n};\n"],"names":["initActivityModal","coursedata","create","type","ModalFactory","types","DEFAULT","title","M","util","get_string","body","footer","large","then","modal","show","getRoot","on","ModalEvents","hidden","destroy","BrowserComponent","element","querySelector","catch","exception","document","addEventListener","e","target","closest","preventDefault","url","URL","window","location","course","searchParams","get","section","el","href","getAttribute"],"mappings":";;;;;;;sQA4BoB,cAwCPA,kBAAkBC,mCACVC,OAAO,CAChBC,KAAMC,uBAAaC,MAAMC,QACzBC,MAAOC,EAAEC,KAAKC,WAAW,qBAAsB,cAC/CC,0LAGAC,OAAQ,cACRC,OAAO,IACRC,MAAMC,QACLA,MAAMC,OACND,MAAME,UACDC,GAAGC,sBAAYC,QAAQ,KACpBL,MAAMM,iBAIVC,0BAAiB,CACjBC,QAASR,MAAME,UAAU,GAAGO,cAAc,2BAC1CvB,WAAAA,cAGG,KACRwB,MAAMC,yBA9DbC,SAAShB,KAAKiB,iBAAiB,SAAUC,OACjCA,EAAEC,OAAOC,QAAQ,8BAA+B,CAChDF,EAAEG,uBACIC,IAAM,IAAIC,IAAIC,OAAOC,iBAOpBpC,kBALY,CACfqC,OAAQJ,IAAIK,aAAaC,IAAI,UAC7BC,QAASP,IAAIK,aAAaC,IAAI,gBAMlCV,EAAEC,OAAOC,QAAQ,gCAAiC,OAC5CU,GAAKZ,EAAEC,OAAOC,QAAQ,gCACtBW,KAAOD,IAAMA,GAAGjB,cAAc,sCAAsCmB,aAAa,YAElFD,YACM,EAGXb,EAAEG,uBAEIC,IAAM,IAAIC,IAAIQ,aAMb1C,kBALY,CACfqC,OAAQJ,IAAIK,aAAaC,IAAI,MAC7BC,QAASP,IAAIK,aAAaC,IAAI"}