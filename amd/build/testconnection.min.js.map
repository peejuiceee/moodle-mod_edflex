{"version":3,"file":"testconnection.min.js","sources":["../src/testconnection.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tests the connection to the Edflex API.\n *\n * @module    mod_edflex/testconnection\n * @copyright 2025 Edflex <support@edflex.com>\n * @license   https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport {get_strings as getStrings} from 'core/str';\n\nexport const init = () => {\n    document.body.addEventListener('click', async(e) => {\n        if (e.target && e.target.id === 'mod_edflex_test_api_connection_btn') {\n            const [successMessage, errorMessage] = await getStrings([\n                {key: 'apiconnectionsuccess', component: 'mod_edflex'},\n                {key: 'apiconnectionerror', component: 'mod_edflex'}\n            ]);\n\n            const notificationContainer = document.getElementById('mod_edflex_connection_status');\n            notificationContainer.textContent = '';\n\n            const apiurl = document.getElementById('id_s_mod_edflex_apiurl')?.value || '';\n            const clientid = document.getElementById('id_s_mod_edflex_clientid')?.value || '';\n            const clientsecret = document.getElementById('id_s_mod_edflex_clientsecret')?.value || '';\n\n            const args = {apiurl, clientid, clientsecret};\n\n            const xhr = Ajax.call([{\n                methodname: 'mod_edflex_test_api_connection',\n                args: args\n            }])[0];\n\n            xhr.done((response) => {\n                if (response.success) {\n                    notificationContainer.textContent = successMessage;\n                } else {\n                    notificationContainer.textContent = errorMessage;\n                }\n            });\n\n            xhr.fail((error) => {\n                const msg = error?.message || '';\n                const pre = document.createElement('pre');\n                pre.textContent = `${errorMessage} ${msg}`;\n                notificationContainer.textContent = '';\n                notificationContainer.appendChild(pre);\n            });\n        }\n    });\n};\n"],"names":["document","body","addEventListener","async","e","target","id","successMessage","errorMessage","key","component","notificationContainer","getElementById","textContent","args","apiurl","value","clientid","clientsecret","xhr","Ajax","call","methodname","done","response","success","fail","error","msg","message","pre","createElement","appendChild"],"mappings":";;;;;;;oJA0BoB,KAChBA,SAASC,KAAKC,iBAAiB,SAASC,MAAAA,OAChCC,EAAEC,QAA0B,uCAAhBD,EAAEC,OAAOC,GAA6C,+EAC3DC,eAAgBC,oBAAsB,oBAAW,CACpD,CAACC,IAAK,uBAAwBC,UAAW,cACzC,CAACD,IAAK,qBAAsBC,UAAW,gBAGrCC,sBAAwBX,SAASY,eAAe,gCACtDD,sBAAsBE,YAAc,SAM9BC,KAAO,CAACC,sCAJCf,SAASY,eAAe,wFAA2BI,QAAS,GAIrDC,yCAHLjB,SAASY,eAAe,4FAA6BI,QAAS,GAG/CE,6CAFXlB,SAASY,eAAe,gGAAiCI,QAAS,IAIjFG,IAAMC,cAAKC,KAAK,CAAC,CACnBC,WAAY,iCACZR,KAAMA,QACN,GAEJK,IAAII,MAAMC,WACFA,SAASC,QACTd,sBAAsBE,YAAcN,eAEpCI,sBAAsBE,YAAcL,gBAI5CW,IAAIO,MAAMC,cACAC,KAAMD,MAAAA,aAAAA,MAAOE,UAAW,GACxBC,IAAM9B,SAAS+B,cAAc,OACnCD,IAAIjB,sBAAiBL,yBAAgBoB,KACrCjB,sBAAsBE,YAAc,GACpCF,sBAAsBqB,YAAYF"}